<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="Richard Walker">
<title>Pragmatic OpenShift</title>
<style>
/* Custom AsciiDoc stylesheet based on Fedora and Red Hat text font with side TOC */

/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* @import url(https://fonts.googleapis.com/css2?family=Red+Hat+Text); */

@font-face {
    font-family: 'Red Hat Text';
    font-style: normal;
    font-weight: 400;
    src: local('Red Hat Text'), local('RedHatText-Regular'), url(fonts/RedHatText-Regular.woff2) format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Red Hat Text",sans-serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Red Hat Text",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Red Hat Text",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Red Hat Text",sans-serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Red Hat Text",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#ddd}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Red Hat Text",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code{color:rgba(0,0,0,.8)}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Red Hat Text",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */
:root{
    --maincolor:#FFFFFF;
    --primarycolor:#294172; /* Fedora Dark Blue */
    --secondarycolor:#3c6eb4; /* Fedora Blue */
    --tertiarycolor:#CCCCCC;
    --sidebarbackground:#CACACA;
    --linkcolor:#0D47A1;
    --linkcoloralternate:#294172; /* Friends Magneta */
    --white:#FFFFFF; 
    --black:#000000;
    }
    
    /* Text styles */
    
    body{font-family: 'Red Hat Text', sans-serif;background-color: var(--maincolor);color:var(--black);}
    
    h1{color:var(--primarycolor) !important;font-family:"Red Hat Text",sans-serif;}
    h2,h3,h4,h5,h6{color:var(--secondarycolor) !important;font-family:"Red Hat Text",sans-serif;}
    .title{color:var(--black) !important;font-family:"Red Hat Text",sans-serif;font-style: normal; font-weight: normal;}
    a{text-decoration: none;}
    p{font-family: "Red Hat Text",sans-serif ! important}
    #toc.toc2 a:link{color:var(--linkcolor);}
    blockquote{color:var(--linkcoloralternate) !important}
    .quoteblock blockquote:before{color:var(--linkcoloralternate)}
    code{color:var(--black);background-color: var(--highlightcolor) !important}
    mark{background-color: var(--highlightcolor)} /* Text highlighting color */
    
    /* Table styles */
    th{background-color: var(--maincolor);color:var(--black) !important;}
    td{background-color: var(--maincolor);color: var(--black) !important}
    
    
    #toc.toc2{background-color:var(--sidebarbackground);}
    #toctitle{color:var(--white);}
    
    /* Responsiveness fixes */
    video {
      max-width: 100%;
    }
    
    @media all and (max-width: 600px) {
    table {
      width: 55vw!important;
      font-size: 3vw;
    }
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Pragmatic OpenShift</h1>
<div class="details">
<span id="author" class="author">Richard Walker</span><br>
<span id="email" class="email"><a href="mailto:me@richardwalker.dev">me@richardwalker.dev</a></span><br>
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_openshift_4_6">OpenShift 4.6</a>
<ul class="sectlevel2">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_infrastructure">Infrastructure</a>
<ul class="sectlevel3">
<li><a href="#_architecture_overview">Architecture Overview</a></li>
</ul>
</li>
<li><a href="#_prerequisites">Prerequisites</a>
<ul class="sectlevel3">
<li><a href="#_raspberry_pi">Raspberry Pi</a></li>
<li><a href="#_dns">DNS</a></li>
<li><a href="#_haproxy">HAProxy</a></li>
<li><a href="#_apache_web_server">Apache Web Server</a></li>
</ul>
</li>
<li><a href="#_installation">Installation</a>
<ul class="sectlevel3">
<li><a href="#_client_tools">Client Tools</a></li>
<li><a href="#_dependencies">Dependencies</a></li>
<li><a href="#_bootstrap_node">Bootstrap node</a></li>
<li><a href="#_master_nodes">Master nodes</a></li>
</ul>
</li>
<li><a href="#_nodes">Nodes</a>
<ul class="sectlevel3">
<li><a href="#_infra">Infra</a></li>
<li><a href="#_worker">Worker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Preface</p>
</div>
<div class="paragraph">
<p>OpenShift was first launched in 2011 and relied on Linux containers to deploy and run user applications. In 2014, Kubernetes was open-sourced by Google, pitched as"
a system for automating deployment, scaling, and operations of application containers."</p>
</div>
<div class="paragraph">
<p>The release of OpenShift V3 was quite substantial. OpenShift began using containers and images, and to orchestrate those images, V3 introduced using Kubernetes.</p>
</div>
<div class="paragraph">
<p>Red Hat proved to be at the forefront of container technology, second only to Google in contributions to Cloud Native Computing Foundation (CNCF) projects. Moreover, the acquisition of CoreOS in January 2018. The CoreOS flagship product was a lightweight Linux operating system designed to run containerized applications, and Red Hat made available in OpenShift V4 as "Red Hat Enterprise Linux CoreOS".</p>
</div>
<div class="paragraph">
<p>Red Hat OpenShift is one of those technologies causing a lot of noise and demand for skills in the Information Technology industry. Still relatively young, it is under massive development and evolving faster than professionals can keep up.</p>
</div>
<div class="paragraph">
<p>The pragmatic OpenShift guide aims to provide a hands-on approach to deploying and configuring OpenShift 4.6.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_openshift_4_6">OpenShift 4.6</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>This document aims to remove the ambiguity sometimes found in the official documentation and using clear examples, demonstrate how to deploy an OpenShift cluster and complete the most common post-installation, configuration tasks.</p>
</div>
<div class="paragraph">
<p>The primary purpose of the information detailed is for learning and building a personal lab environment. Therefore the scenarios are not intended for production use. However, it is the know-how what counts.</p>
</div>
<div class="paragraph">
<p>OpenShift is a rapidly moving target, with minor releases often incrementing weekly, this document is focused on OpenShift 4.6.</p>
</div>
<div class="paragraph">
<p>A challenge for a would-be OpenShift administrator is the accessibility to technology. Minimum requirements are enormous, and let us remember OpenShift (based on Kubernetes) is a cloud-native platform first. Evident from when OpenShift 4.1 was first released. Initially, it only supported Amazon Web Services (AWS) using the Installer Provisioned Infrastructure (IPI).</p>
</div>
<div class="paragraph">
<p>Today, OpenShift now supports AWS, Azure, GCP, IBM, OpenStack, RHV, vSphere and bare metal. All of these have their nuances, and for a home lab, most are too costly for learning and experimenting.</p>
</div>
<div class="paragraph">
<p>Bare metal allows us to provision infrastructure, and the User Provisioned Infrastructure (UPI) installation enables customisations. The process of doing a UPI bare-metal installation is far more involved than say an AWS IPI. However, the knowledge gained is invaluable, and the result is a local cluster, albeit a minimal three-node cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_infrastructure">Infrastructure</h3>
<div class="paragraph">
<p>Infrastructure is the compute resources that software platforms get deployed on to. Traditionally and as demonstrated in this documentation that can be physical hardware. It might mean virtualisation using hypervisors such as VMware, Red Hat Virtualisation or  Hyper-V for example. Most commonly, it will likely mean cloud infrastructure. Cloud infrastructure builds on virtualisation providing on-demand abstracted resources such as hardware,  storage, and network resources.</p>
</div>
<div class="paragraph">
<p>In reality, cloud infrastructure resources are costly and move capital expenditure (CapEx) to operation expenditure (OpEx).  For a lab environment, a monthly bill using cloud resources would equate to the outright purchase of sufficient hardware to keep forever. For production enterprise environments, resilience, scalability and flexibility of OpEx infrastructure are highly appealing and make sense.  However, for learning, experimentation, and keeping costs down with the purchase of hardware for the long term is appealing.</p>
</div>
<div class="paragraph">
<p>This guide demonstrates using  IntelÂ® NUC&#8217;s for master nodes, which are affordable, compact with low power consumption.  Furthermore, a Raspberry Pi used for the core utility services including DNS, Load Balancer and Apache webserver.</p>
</div>
<div class="sect3">
<h4 id="_architecture_overview">Architecture Overview</h4>
<div class="paragraph">
<p>The following diagram is a high-level overview of the lab environment deployed in this document. It depicts both the physical hosts and virtual hosts that make up a hybrid cluster.  The virtual hosts include the temporary bootstrap host, only needed during the initial deployment of the three master nodes.</p>
</div>
<div class="paragraph">
<p>Three master nodes make up a minimal cluster. The nodes will play the role of "master", "worker" and "infra" nodes.</p>
</div>
<div class="paragraph">
<p>Further scaling of the cluster is optional and done using virtual machines (VM) with network bridging. Using VMs provides flexibility where resources are limited. Temporarily adding and removing worker and infrastructure nodes is excellent for trying various activities while keeping the three core physical master nodes permanently.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/overview-arch.png" alt="Architecture Overview">
</div>
</div>
<div class="paragraph">
<p>The following table includes the details of the environment used throughout this document:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Host Details</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>DNS Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>IP Address</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>client.local</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.35</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>RHEL8/Fedora32 client laptop</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>utilities.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.101</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Raspberry Pi 3 Model B, 4 core 1GB RAM, 8GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>bootstrap.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.102</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>master1.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.111</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Intel NUC i5, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>master2.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.112</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Intel NUC i5, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>master3.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.113</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Intel NUC i5, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Worker and Infra node examples</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>DNS Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>IP Address</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>worker1.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.121</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>worker2.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.122</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>worker3.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.123</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>infra1.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.131</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>infra2.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.132</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>infra3.cluster.lab.com</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.0.133</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KVM VM, 4 core, 16GB RAM, 120GB storage</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>Getting the prerequisites right is the essential part of deploying OpenShift. Mistakes with DNS, load balancing or networking in general, will only lead problems with the deployment of the cluster. Troubleshooting OpenShift deployments is notoriously challenging and often misleading towards the real root cause of issues.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
With OpenShift 4, begin with a minimal working deployment, adding subsequent nodes and performing any cluster configuration post-deployment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once bootstrapping is completed, the minimal cluster will look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/overview-min.png" alt="Minimal Target Architecture Overview">
</div>
</div>
<div class="paragraph">
<p>In this guide, a Raspberry Pi is used, but it does not need to be, any host either physical or virtual (providing it is either on the same subnet or sufficient routing configured) with CentOS 7 or 8 install will do.</p>
</div>
<div class="paragraph">
<p>Regardless of the device, Domain Name System (DNS) needs to be in place and the provisioning of two load balancers (LB). One LB for the Application Programming Interface (API) and another LB for ingress application traffic flowing in from outside the cluster. A web server is also needed to serve files and images used for provisioning hosts.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All steps documented assume a Linux client computer either Fedora, CentOS or Red Hat Enterprise Linux.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_raspberry_pi">Raspberry Pi</h4>
<div class="paragraph">
<p>Refer to the following for information regarding CentOS for Raspberry Pi: <a href="https://wiki.centos.org/SpecialInterestGroup/AltArch/Arm32/RaspberryPi3">wiki.centos.org</a></p>
</div>
<div class="paragraph">
<p>In this document <code>CentOS-Userland-7-armv7hl-RaspberryPI-Minimal-2009-sda.raw.xz</code> was used.</p>
</div>
<div class="paragraph">
<p><code>xz</code> is a lossless compression program, if not already installed, install it on your client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dnf install xz -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Decompress the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>unxz CentOS-Userland-7-armv7hl-RaspberryPI-Minimal-2009-sda.raw.xz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>fdisk</code> to identify existing storage devices on your system, then insert the MicroSD card, using <code>fdisk</code> again to identify the card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>fdisk -l</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">[ ... output omitted ... ]
Disk /dev/sda: 14.9 GiB, 15931539456 bytes, 31116288 sectors
[ ... output omitted ... ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>dd</code> write the image to the SD card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">sudo dd if=CentOS-Userland-7-armv7hl-RaspberryPI-Minimal-2009-sda.raw of=/dev/sda bs=8192 status=progress; sync</code></pre>
</div>
</div>
<div class="paragraph">
<p>Insert the SD card and power on the Raspberry Pi, logging in as <code>root</code> with the default password of <code>centos</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Username: root
Password: centos</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expand the filesystem with <code>/usr/bin/rootfs-expand</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/usr/bin/rootfs-expand</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the hostname:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>hostnamectl set-hostname utilities.cluster.lab.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remove NetworkManger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum remove NetworkManager</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code> and configure it as a static IP, I&#8217;m setting it to <code>192.168.0.101</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>DEVICE=eth0
TYPE=Ethernet
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.0.101
PREFIX=24
GATEWAY=192.168.0.1
DNS1=192.168.0.1</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
As a rule of thumb, take the time and effort to manage SELinux and <code>firewalld</code> correctly, in this case, to save time and focus on the prerequisites and deployment of OpenShift, disable both:
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Disable SELinux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/sysconfig/selinux</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>SELINUX=disabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disable firewall:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>systemctl stop firewalld
systemctl disable firewalld</code></pre>
</div>
</div>
<div class="paragraph">
<p>These can be configured these later, but the less potential cause of issues the better because troubleshooting can be tricky if numerous problems are in the equation. Get the most basic working deployment complete, then introduce things one at a time making the process of troubleshooting "cause and effect" easier.</p>
</div>
<div class="paragraph">
<p>Install any updates and reboot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum update -y
reboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the changes made are correct, test the static IP address using SSH from a client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ssh root@192.168.0.101</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dns">DNS</h4>
<div class="paragraph">
<p>Install <code>dnsmasq</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum install dnsmasq -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Backup the original configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <code>dnsmasq.conf</code> configuration file includes a few things but a key line to point out is the <code>apps.cluster.lab.com</code> line which provides the wildcard DNS resolution such as <code>foo.apps.cluster.lab.com</code> or <code>bar.apps.cluster.lab.com</code>:</p>
</div>
<div class="paragraph">
<p>Edit dnsmasq.conf:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/dnsmasq.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>server=192.168.0.1
server=8.8.8.8
server=8.8.4.4
local=/cluster.lab.com/
address=/apps.cluster.lab.com/192.168.0.101
interface=eth0
listen-address=::1,127.0.0.1,192.168.0.101
expand-hosts
domain=cluster.lab.com
addn-hosts=/etc/dnsmasq.openshift.hosts
conf-dir=/etc/dnsmasq.d,.rpmnew,.rpmsave,.rpmorig
srv-host=_etcd-server-ssl._tcp.cluster,master1.cluster.lab.com,2380,0,10
srv-host=_etcd-server-ssl._tcp.cluster,master2.cluster.lab.com,2380,0,10
srv-host=_etcd-server-ssl._tcp.cluster,master3.cluster.lab.com,2380,0,10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next I&#8217;m adding all the DNS entire I might ever need for a cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/dnsmasq.openshift.hosts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>192.168.0.101 utilities.cluster.lab.com dns.cluster.lab.com lb.cluster.lab.com api.cluster.lab.com api-int.cluster.lab.com
192.168.0.102 bootstrap.cluster.lab.com
192.168.0.111 master1.cluster.lab.com etcd-0.cluster.lab.com
192.168.0.112 master2.cluster.lab.com etcd-1.cluster.lab.com
192.168.0.113 master3.cluster.lab.com etcd-2.cluster.lab.com
192.168.0.121 worker1.cluster.lab.com
192.168.0.122 worker2.cluster.lab.com
192.168.0.123 worker3.cluster.lab.com
192.168.0.131 infra1.cluster.lab.com
192.168.0.132 infra2.cluster.lab.com
192.168.0.133 infra3.cluster.lab.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next configure this host to use itself for DNS resolution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/resolv.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>search Home cluster.lab.com
nameserver 192.168.0.101</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lock <code>resolv.conf</code> from being modified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>chattr +i /etc/resolv.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start and enable the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>systemctl enable dnsmasq.service --now</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install bind-utils:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum install bind-utils -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test some lookups, both IP Addresses and DNS entries should be resolvable, including <code>anything.apps.cluster.lab.com</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>nslookup www.google.com
nslookup master1.cluster.lab.com
nslookup 192.168.0.111
nslookup foo.apps.cluster.lab.com
nslookup bar.apps.cluster.lab.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_haproxy">HAProxy</h4>
<div class="paragraph">
<p>Install HAProxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum install haproxy -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Back up the original configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following configuration (changing IPs for your environment)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/haproxy/haproxy.cfg</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>global
    log         127.0.0.1 local2
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

    stats socket /var/lib/haproxy/stats

defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    30s
    timeout queue           1m
    timeout connect         30s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 30s
    timeout check           30s
    maxconn                 4000

frontend api
    bind 0.0.0.0:6443
    option tcplog
    mode tcp
    default_backend api

backend api
    option httpchk GET /healthz
    http-check expect status 200
    mode tcp
    balance roundrobin
    server bootstrap bootstrap.cluster.lab.com:6443 check check-ssl verify none
    server master1 master1.cluster.lab.com:6443 check check-ssl verify none
    server master2 master2.cluster.lab.com:6443 check check-ssl verify none
    server master3 master3.cluster.lab.com:6443 check check-ssl verify none

frontend api-int
    bind 0.0.0.0:22623
    option tcplog
    mode tcp
    default_backend api-int

backend api-int
    mode tcp
    balance roundrobin
    server bootstrap 192.168.0.102:22623 check
    server master1 192.168.0.111:22623 check
    server master2 192.168.0.112:22623 check
    server master3 192.168.0.113:22623 check

frontend apps-http
    bind 192.168.0.101:80
    option tcplog
    mode tcp
    default_backend apps-http

backend apps-http
    mode tcp
    balance roundrobin
    server master1 master1.cluster.lab.com:80 check
    server master2 master2.cluster.lab.com:80 check
    server master3 master3.cluster.lab.com:80 check

frontend apps-https
    bind 192.168.0.101:443
    option tcplog
    mode tcp
    default_backend apps-https

backend apps-https
    mode tcp
    balance roundrobin
    option ssl-hello-chk
    server master1 192.168.0.111:443 check
    server master2 192.168.0.112:443 check
    server master3 192.168.0.113:443 check

listen stats
    bind 0.0.0.0:9000
    mode http
    balance
    timeout client 5000
    timeout connect 4000
    timeout server 30000
    stats uri /stats
    stats refresh 5s
    stats realm HAProxy\ Statistics
    stats auth admin:changeme
    stats admin if TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>haproxy.conf</code> example purposely uses inconsistent methods of configuration between the load balancers to provide good working examples. The configuration here is  correct for serving OpenShift requirements. Notice the configuration includes an HAProxy Statistics page that auto-refreshes, and that the <code>apps-http</code> excludes the SSL check.</p>
</div>
<div class="paragraph">
<p>Enable and start HAProxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>systemctl enable haproxy.service --now</code></pre>
</div>
</div>
<div class="paragraph">
<p>View the graphical statistics report at <a href="http://192.168.0.101:9000/stats" class="bare">http://192.168.0.101:9000/stats</a>. In this example the username is <code>admin</code> and password is <code>changeme</code>. If you&#8217;ve pointed your local client to use <code>192.168.0.101</code> for its DNS, try <a href="http://lb.cluster.lab.com:9000/stats" class="bare">http://lb.cluster.lab.com:9000/stats</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache_web_server">Apache Web Server</h4>
<div class="paragraph">
<p>Install and configure <code>httpd</code> on port <code>8080</code> (because port 80 is already used by HAProxy)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum install httpd -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit <code>httpd.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi /etc/httpd/conf/httpd.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Listen 8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable and start the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>systemctl enable httpd.service --now</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to append port <code>8080</code> when referring to this service, for example: <a href="http://192.168.0.101:8080/" class="bare">http://192.168.0.101:8080/</a></p>
</div>
<div class="paragraph">
<p>For OpenShift bare metal installations, files can be copied into <code>/var/www/html</code> on this utilities server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>At the time of writing the latest version is 4.6.4. The downloads necessary are publicly available however download a legitimate pull secret from the Red Hat cluster portal. Vising <a href="https://cloud.redhat.com/openshift/install/metal/user-provisioned" class="bare">https://cloud.redhat.com/openshift/install/metal/user-provisioned</a> for the latest versions and obtaining your pull secret.</p>
</div>
<div class="sect3">
<h4 id="_client_tools">Client Tools</h4>
<div class="paragraph">
<p>Download the OpenShift installer program on your client computer:</p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-install-linux.tar.gz" class="bare">https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-install-linux.tar.gz</a></p>
</div>
<div class="paragraph">
<p>Download the OpenShift command-line tools:</p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz" class="bare">https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz</a></p>
</div>
<div class="paragraph">
<p>Checksums:</p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/sha256sum.txt" class="bare">https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/sha256sum.txt</a></p>
</div>
<div class="paragraph">
<p>Check the integrity of the downloaded files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sha256sum openshift-client-linux.tar.gz
sha256sum openshift-install-linux.tar.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>c1f39a966fc0dbd4f8f0bfec0196149d54e0330de523bf906bbe2728b10a860b  openshift-client-linux.tar.gz
b81e1d25d77a05eaae8c0f154ed563c2caee21ed63401d655a7ad3206fdfd53c  openshift-install-linux.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make a <code>bin</code> directory in your home directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mkdir ~/bin</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may prefer to extract to <code>/usr/local/bin/</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Extract the CLI tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>tar -xvf openshift-client-linux.tar.gz -C ~/bin
tar -xvf openshift-install-linux.tar.gz -C ~/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the <code>oc</code> version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>oc version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Client Version: 4.6.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the <code>openshift-install</code> version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>openshift-install version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>openshift-install 4.6.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a working directory, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mkdir -p ~/ocp4/cluster &amp;&amp; cd ~/ocp4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate a new SSH key pair that will be embedded into the OpenShift deployment, this will enable you to SSH to OpenShift nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ssh-keygen -t rsa -b 4096 -N '' -f cluster_id_rsa</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an installation configuration file, the compute replicas is always set to zero for bare metal, this refers to worker nodes which are manually added post-deployment. The key option here is the <code>controlPlane: replicas</code> needs to be either <code>1</code> for a single node cluster or <code>3</code> for the minimal three node cluster. The bootstrap process does not complete until this defined critical is met, so plan ahead!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>vi install-config.yaml.orig</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>apiVersion: v1
baseDomain: lab.com
compute:
- hyperthreading: Enabled
  name: worker
  replicas: 0
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3
metadata:
  name: cluster
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  none: {}
fips: false
pullSecret: '{"auths": ...}'
sshKey: 'ssh-ed25519 AAAA...'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the configuration file into the cluster directory, it&#8217;s important to have the original copy because the installation process destroys it! It&#8217;s handy to keep for reference and because in reality it usually takes a few attempts to get right.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to paste in your real pull secret and public key.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cp install-config.yaml.orig cluster/install-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following two commands create and initiates the installation process. The first create manifests step gives you an opportunity to make further tweak to the deployment. The create ignition-configs uses those manifest to create the ignition files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>openshift-install create manifests --dir=cluster
openshift-install create ignition-configs --dir=cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The files in the <code>cluster</code> directory should now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>auth
bootstrap.ign
master.ign
metadata.json
worker.ign</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dependencies">Dependencies</h4>
<div class="paragraph">
<p>Download the installer ISO image and the compressed metal RAW:</p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-installer.x86_64.iso" class="bare">https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-installer.x86_64.iso</a></p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-metal.x86_64.raw.gz" class="bare">https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-metal.x86_64.raw.gz</a></p>
</div>
<div class="paragraph">
<p>Checksums:</p>
</div>
<div class="paragraph">
<p><a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/sha256sum.txt" class="bare">https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/sha256sum.txt</a></p>
</div>
<div class="paragraph">
<p>Check the integrity of the downloaded files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sha256sum rhcos-installer.x86_64.iso
sha256sum rhcos-metal.x86_64.raw.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>d15bd7ae942573eece34ba9c59e110e360f15608f36e9b83ab9f2372d235bef2  rhcos-installer.x86_64.iso
7e61bbe56735bc26d0808d4fffc4ccac25554df7d3c72c7b678e83e56c7ac5ba  rhcos-metal.x86_64.raw.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the three ignition files and the Red Hat CoreOS image to the <code>utilities.cluster.lab.com</code>, to be served by Apache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>scp cluster/*.ign root@192.168.0.101:/var/www/html/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the Red Hat CoreOS image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>scp rhcos-metal.x86_64.raw.gz root@192.168.0.101:/var/www/html/</code></pre>
</div>
</div>
<div class="paragraph">
<p>On <code>utilities.cluster.lab.com</code> ensure file permissions are correct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>chmod 644 /var/www/html/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the client computer test these files are available to download via HTTP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>wget http://192.168.0.101:8080/bootstrap.ign</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrap_node">Bootstrap node</h4>
<div class="paragraph">
<p>Using either using Virtual machine manager to create a KVM VM or VirtualBox, create a Virtual Machine with 4 cores, 16GB RAM (16384) and 120GB of storage. This VM will is destroyed after the cluster installation is complete.</p>
</div>
<div class="paragraph">
<p>Using the <code>rhcos-metal.x86_64.raw.gz</code> boot the VM up, until you arrive at a command prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$[core@localhost ~]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The VM will have an IP Address assigned via DHCP, we need to set a static IP.</p>
</div>
<div class="paragraph">
<p>View current interface IP Address:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ip a</code></pre>
</div>
</div>
<div class="paragraph">
<p>View the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>nmcli con show</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connection</p>
</div>
<div class="paragraph">
<p>Set the IPAddress for the bootstrap node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">nmcli con mod 'Wired Connection' ipv4.method manual ipv4.addresses 192.168.0.102/24 ipv4.gateway 192.168.0.1 ipv4.dns 192.168.0.101 connection.autoconnect yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart Network Manager and bring up the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo systemctl restart NetworkManager
nmcli con up 'Wired Connection'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start the CoreOS installer, providing the <code>bootstrap.ign</code> ignition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo coreos-installer install --ignition-url=http://192.168.0.101:8080/bootstrap.ign /dev/sda --insecure-ignition --copy-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reboot the VM with <code>reboot</code>, make sure the VM boots from the hard disk storage (eject the ISO before it boots) or <code>shutdown</code> the VM and remove the CD-ROM from the boot order.</p>
</div>
<div class="paragraph">
<p>Make sure the VM boots up with the correct IP Address previously assigned:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bootstrap-prompt.png" alt="Bootstrap login prompt">
</div>
</div>
<div class="paragraph">
<p>Once the bootstrap node is up and at the login prompt with the correct IP Address, the VM should provision itself, and eventually come up in the load balancer <a href="http://192.168.0.101:9000/stats" class="bare">http://192.168.0.101:9000/stats</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bootstrap-lb.png" alt="Bootstrap load balancer">
</div>
</div>
<div class="paragraph">
<p>From a Linux client you should be able to SSH to it using the private key generated earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ssh -i cluster_id_rsa core@192.168.0.102</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the progress on the bootstrap node with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>journalctl -b -f -u release-image.service -u bootkube.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following pods should eventually be up and running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo crictl pods

...Ready               bootstrap-kube-scheduler-bootstrap.cluster.lab.com...
...Ready               bootstrap-kube-controller-manager-bootstrap.cluster.lab.com...
...Ready               bootstrap-kube-apiserver-bootstrap.cluster.lab.com...
...Ready               cloud-credential-operator-bootstrap.cluster.lab.com...
...Ready               bootstrap-cluster-version-operator-bootstrap.cluster.lab.com...
...Ready               bootstrap-machine-config-operator-bootstrap.cluster.lab.com...
...Ready               etcd-bootstrap-member-bootstrap.cluster.lab.com...</code></pre>
</div>
</div>
<div class="paragraph">
<p>List the running containers and tail the logs of any one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo crictl ps

sudo crictl logs &lt;CONTAINER_ID&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the the Linux client the following command should return <code>ok</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>curl -X GET https://api.cluster.lab.com:6443/healthz -k</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the <code>kubeconfig</code> and test getting cluster operators with <code>oc get co</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>export KUBECONFIG=cluster/auth/kubeconfig
oc get co</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll only see the <code>cloud-credential</code> operator is available at this stage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>NAME                        VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE
authentication
cloud-credential            True        False         False      26m
cluster-autoscaler
config-operator
console
csi-snapshot-controller
dns
etcd
...</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All of these tests <strong>MUST</strong> work as documented else it&#8217;s pointless continuing any further.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any other responses or errors mean there are issues with either networking, DNS or Load Balancing configurations. Go back and troubleshoot any issues until you get the expected results at his stage.</p>
</div>
<div class="paragraph">
<p>On your client you can see the progress of the installation and that it&#8217;s moved on a step because api.cluster.lab.com is up and working:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>openshift-install --dir=cluster wait-for bootstrap-complete</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>INFO Waiting up to 20m0s for the Kubernetes API at https://api.cluster.lab.com:6443...
INFO API v1.19.0+9f84db3 up
INFO Waiting up to 30m0s for bootstrapping to complete...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bootstrapping process will not complete until all three master nodes have been provisioned.</p>
</div>
</div>
<div class="sect3">
<h4 id="_master_nodes">Master nodes</h4>
<div class="paragraph">
<p>For physical host installations, write the <code>rhcos-installer.x86_64.iso</code> image to a USB pen drive.</p>
</div>
<div class="paragraph">
<p>Use <code>fdisk</code> to identify existing storage devices on your system, then insert the USB pen drive, using <code>fdisk</code> again to identify the device:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>fdisk -l</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">[ ... output omitted ... ]
Disk /dev/sda: 58.5 GiB, 62763565056 bytes, 122585088 sectors
[ ... output omitted ... ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write the image to the device:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo dd if=rhcos-installer.x86_64.iso of=/dev/sda status=progress; sync</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next steps repeat the process of booting the three physical nodes using the Red Hat CoreOS ISO. Make sure to use <code>master.ign</code>, and the right IP Address and hostname for each master node. In the case of an Intel NUC, <code>F10</code> is used to interrupt the host BIOS and select a boot device.</p>
</div>
<div class="paragraph">
<p><strong><code>master1.cluster.lab.com</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">coreos.inst=yes
coreos.inst.install_dev=sda
coreos.inst.image_url=http://192.168.0.101:8080/rhcos-metal.raw.gz
coreos.inst.ignition_url=http://192.168.0.101:8080/master.ign
ip=192.168.0.111::192.168.0.1:255.255.255.0:master1.cluster.lab.com:eno1:none:192.168.0.101
nameserver=192.168.0.101</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>master2.cluster.lab.com</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">coreos.inst=yes
coreos.inst.install_dev=sda
coreos.inst.image_url=http://192.168.0.101:8080/rhcos-metal.raw.gz
coreos.inst.ignition_url=http://192.168.0.101:8080/master.ign
ip=192.168.0.112::192.168.0.1:255.255.255.0:master2.cluster.lab.com:eno1:none:192.168.0.101
nameserver=192.168.0.101</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>master3.cluster.lab.com</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">coreos.inst=yes
coreos.inst.install_dev=sda
coreos.inst.image_url=http://192.168.0.101:8080/rhcos-metal.raw.gz
coreos.inst.ignition_url=http://192.168.0.101:8080/master.ign
ip=192.168.0.113::192.168.0.1:255.255.255.0:master3.cluster.lab.com:eno1:none:192.168.0.101
nameserver=192.168.0.101</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nodes">Nodes</h3>
<div class="sect3">
<h4 id="_infra">Infra</h4>

</div>
<div class="sect3">
<h4 id="_worker">Worker</h4>

</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2020-11-23 17:39:27 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>